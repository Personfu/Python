# ============================================================
# Enterprise Firewall Rule Configuration
# CIS 350 — Network & Cybersecurity | Preston Furulie
# Platform: Palo Alto PA-850 (PAN-OS 11.x)
# ============================================================
# Design: Zone-based firewall with least-privilege access.
# Default action: DENY ALL (implicit deny at bottom).
# Rules are evaluated top-to-bottom; first match wins.
# ============================================================

# ════════════════════════════════════════════════════════════
# ZONE DEFINITIONS
# ════════════════════════════════════════════════════════════

# Zone: outside      (Untrusted — Internet/WAN)
# Zone: dmz          (Semi-trusted — public-facing services)
# Zone: corporate    (Trusted — employee workstations, VLAN 20)
# Zone: servers      (High-trust — internal app/DB, VLAN 30)
# Zone: management   (Highest-trust — network admin, VLAN 10)
# Zone: voip         (Trusted — IP phones, VLAN 40)
# Zone: guest        (Low-trust — visitor Wi-Fi, VLAN 50)
# Zone: iot          (Low-trust — cameras/sensors, VLAN 60)


# ════════════════════════════════════════════════════════════
# RULE 1: OUTSIDE → DMZ (Public Web Access)
# Allow HTTPS traffic from the internet to DMZ web servers
# ════════════════════════════════════════════════════════════

set security policy from outside to dmz rule "Allow-Web-Inbound"
    source-zone       outside
    destination-zone  dmz
    source-address    any
    destination-address 172.16.0.10  172.16.0.11
    application       web-browsing  ssl
    service           tcp/80  tcp/443
    action            allow
    log-start         yes
    log-end           yes
    profile-group     "Strict-Security"
    # Security profiles: Antivirus, Anti-Spyware, IPS, URL Filtering


# ════════════════════════════════════════════════════════════
# RULE 2: DMZ → SERVERS (Backend API Access)
# DMZ web servers can reach internal app servers only on
# specific ports — no direct database access from DMZ.
# ════════════════════════════════════════════════════════════

set security policy from dmz to servers rule "DMZ-to-AppServer"
    source-zone       dmz
    destination-zone  servers
    source-address    172.16.0.10  172.16.0.11
    destination-address 10.0.30.10  10.0.30.11
    application       web-browsing  ssl
    service           tcp/3000  tcp/443
    action            allow
    log-end           yes


# ════════════════════════════════════════════════════════════
# RULE 3: SERVERS (App → DB) Internal Communication
# App servers can connect to database on MySQL port only.
# ════════════════════════════════════════════════════════════

set security policy from servers to servers rule "App-to-Database"
    source-zone       servers
    destination-zone  servers
    source-address    10.0.30.10  10.0.30.11
    destination-address 10.0.30.50
    service           tcp/3306
    action            allow
    log-end           yes

set security policy from servers to servers rule "App-to-Redis"
    source-zone       servers
    destination-zone  servers
    source-address    10.0.30.10  10.0.30.11
    destination-address 10.0.30.51
    service           tcp/6379
    action            allow
    log-end           yes


# ════════════════════════════════════════════════════════════
# RULE 4: CORPORATE → OUTSIDE (Employee Internet)
# Allow employees filtered internet access.
# Block high-risk categories and P2P protocols.
# ════════════════════════════════════════════════════════════

set security policy from corporate to outside rule "Employee-Internet"
    source-zone       corporate
    destination-zone  outside
    source-address    10.0.20.0/24
    destination-address any
    application       web-browsing  ssl  dns  smtp  pop3  imap
    service           tcp/80  tcp/443  tcp/587  udp/53
    action            allow
    log-end           yes
    profile-group     "Standard-Security"
    # URL Filtering: Block malware, phishing, gambling, adult,
    #                hacking, proxy-avoidance categories

set security policy from corporate to outside rule "Block-P2P"
    source-zone       corporate
    destination-zone  outside
    source-address    10.0.20.0/24
    destination-address any
    application       bittorrent  tor  anonymizer
    action            deny
    log-start         yes


# ════════════════════════════════════════════════════════════
# RULE 5: CORPORATE → SERVERS (Internal Services)
# Employees access internal applications, SSH, and RDP.
# ════════════════════════════════════════════════════════════

set security policy from corporate to servers rule "Corp-to-Servers"
    source-zone       corporate
    destination-zone  servers
    source-address    10.0.20.0/24
    destination-address 10.0.30.0/24
    application       web-browsing  ssl  ssh  ms-rdp  mysql
    service           tcp/80  tcp/443  tcp/22  tcp/3389  tcp/3306
    action            allow
    log-end           yes


# ════════════════════════════════════════════════════════════
# RULE 6: MANAGEMENT → ALL (Admin Access)
# Network admins from Management VLAN have full access
# to all zones for device management.
# ════════════════════════════════════════════════════════════

set security policy from management to any rule "Admin-Full-Access"
    source-zone       management
    destination-zone  any
    source-address    10.0.10.0/24
    destination-address any
    application       any
    action            allow
    log-start         yes
    log-end           yes
    # Admin actions are fully logged for audit trail


# ════════════════════════════════════════════════════════════
# RULE 7: GUEST → OUTSIDE (Guest Internet Only)
# Guest Wi-Fi can only reach the internet for web browsing.
# No access to any internal resources.
# ════════════════════════════════════════════════════════════

set security policy from guest to outside rule "Guest-Internet"
    source-zone       guest
    destination-zone  outside
    source-address    10.0.50.0/24
    destination-address any
    application       web-browsing  ssl  dns
    service           tcp/80  tcp/443  udp/53
    action            allow
    log-end           yes
    profile-group     "Guest-Security"
    # Bandwidth limit: 10 Mbps per user
    # URL Filtering: Block all high-risk categories

# DENY guest to ALL internal zones
set security policy from guest to corporate rule "Guest-Deny-Corp"
    source-zone       guest
    destination-zone  corporate  servers  management  voip  iot
    source-address    any
    destination-address any
    action            deny
    log-start         yes


# ════════════════════════════════════════════════════════════
# RULE 8: VoIP ZONE (QoS and SIP)
# ════════════════════════════════════════════════════════════

set security policy from voip to outside rule "VoIP-SIP"
    source-zone       voip
    destination-zone  outside
    source-address    10.0.40.0/24
    destination-address any
    application       sip  rtp
    service           udp/5060  udp/5061  udp/10000-20000
    action            allow
    qos-marking       dscp  ef
    log-end           yes


# ════════════════════════════════════════════════════════════
# RULE 9: IoT ZONE (Cameras — Restricted)
# IoT devices can only send data to the internal camera
# server. No internet access (prevent botnet participation).
# ════════════════════════════════════════════════════════════

set security policy from iot to servers rule "IoT-Camera-Feed"
    source-zone       iot
    destination-zone  servers
    source-address    10.0.60.0/24
    destination-address 10.0.30.60
    service           tcp/443  tcp/554
    action            allow
    log-end           yes

set security policy from iot to outside rule "IoT-Deny-Internet"
    source-zone       iot
    destination-zone  outside
    source-address    10.0.60.0/24
    destination-address any
    action            deny
    log-start         yes


# ════════════════════════════════════════════════════════════
# RULE 10: VPN Remote Access
# ════════════════════════════════════════════════════════════

set security policy from outside to management rule "VPN-Access"
    source-zone       outside
    destination-zone  management
    source-address    any
    destination-address 172.16.0.1
    application       ipsec  ssl-vpn
    service           udp/500  udp/4500  tcp/443
    action            allow
    log-start         yes
    log-end           yes
    # MFA required via GlobalProtect client


# ════════════════════════════════════════════════════════════
# RULE 99: IMPLICIT DENY ALL (Catch-All)
# Default deny — anything not explicitly allowed is blocked.
# ════════════════════════════════════════════════════════════

set security policy from any to any rule "Deny-All-Default"
    source-zone       any
    destination-zone  any
    source-address    any
    destination-address any
    application       any
    action            deny
    log-start         yes
    # Alert on repeated denials from same source (potential scan)
